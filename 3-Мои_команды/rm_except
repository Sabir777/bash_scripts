#!/bin/bash

# Команда для удаления папок или файлов по принципу: "Удалить все кроме того что указано в шаблоне"
# Можно удалять файлы или папки: для этого нужно явно указать тип удаляемых объектов (-f или -d)
# Образец команды: rm_except -d нужная_папка1 нужная_папка2 (пользуюсь шаблонами)

if [[ "$1" != "-f" && "$1" != "-d" && "$1" != "-a" ]]; then
    echo -e "Задайте тип удаляемых объектов:\n-f - для файлов\n-d - для папок\n-a - для файлов и папок \
\n\nПример команды:\nrm_except -f мой_файл1 мой_файл2 (удалит все файлы кроме указанных)"
    exit 1
fi

# Получаю список шаблонов (исключений)
temps=("${@:2}")

# Проверка на пустой список шаблонов
if [[ ${#temps[@]} -eq 0 ]]; then
    echo "Ошибка: не указаны шаблоны файлов/папок, которые нужно сохранить."
    exit 1
fi

# Формирую параметры исключения для find
ignore=(-not -name "." -not -name "..")  # Исключаю текущую директорию
for el in "${temps[@]}"; do
    ignore+=(-not -name "$el")
done

# Определяю параметры поиска
find_args=(-maxdepth 1 "${ignore[@]}")

if [[ "$1" == "-a" ]]; then
    # Удаляю файлы
    find . "${find_args[@]}" -type f -exec rm -f {} +
    # Удаляю папки
    find . "${find_args[@]}" -type d -exec rm -rf {} +
else
    type_flag=""
    [[ "$1" == "-f" ]] && type_flag="f"
    [[ "$1" == "-d" ]] && type_flag="d"

    # Удаляю файлы или папки
    if [[ "$type_flag" == "f" ]]; then
        find . -maxdepth 1 -type f "${ignore[@]}" -exec rm -f {} +
    else
        find . -maxdepth 1 -type d "${ignore[@]}" -exec rm -rf {} +
    fi
fi

