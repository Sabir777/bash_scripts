#!/bin/bash

# Команда для удаления промежутков (дыр) в последовательности из названий папок

# Логика команды:
# Если у меня папки называются: 1-a, 3-a, 4-a (отсутствует папка с номером-2)
# Мне нужно сделать непрерывную нумерацию (без дыр)
# Должна получится последовательность папок: 1-a, 2-a (бывшая 3-a), 3-a (бывшая 4-a)
# Программа должна автоматически найти все дыры в нумерации и удалить их через переименование папок с уменьшением порядкового номера

# Синтаксис команды
# folder-hole


# Получить номер папки
number() {
    echo "$1" | grep -o -P '^\d+'
}


# Переименовать папку
rename() {
    # Ссылка на переданный массив
    local -n ref=$1
    local index=$2 name=$3
    local old=$(number $name)
    local new=$4
    ref[$index]="${name/$old/$new}"
    mv "$name" "${name/$old/$new}"
}


# Ищу папки название которых начинается смцифры
find_args=(-maxdepth 1 -name "[0-9]*")

# Создаю отсортированный массив из имен папок
iter=($(find . "${find_args[@]}" -type d | sort -V | sed 's|.*/||'))

# Переименовываю папки
for ((i = 1; i < ${#iter[@]}; i++)); do
    prev=$(number "${iter[$(($i - 1))]}")
    next=$(number "${iter[$i]}")
    new_num=$(($prev + 1))
    dx=$(($next - $prev))
    if [[ $dx -gt 1 ]]; then
        rename iter $i "${iter[$i]}" "$new_num"
    fi
done

